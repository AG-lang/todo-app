<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>ğŸ“‹ ToDo ä»»åŠ¡ç®¡ç†</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- è‡ªå®šä¹‰æ ·å¼ -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .task-card {
            background-color: #ffffff;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 0 10px rgba(0,0,0,0.05);
        }
        .task-title.completed {
            text-decoration: line-through;
            color: #888;
        }
        .task-time {
            font-size: 0.8rem;
            color: #999;
        }
        .task-actions button {
            margin-left: 5px;
        }
    </style>
</head>
<body>
    <div class="container mt-5" style="max-width: 700px;">
        <div class="task-card">

            <h2 class="mb-4 text-center">ğŸ“‹ æˆ‘çš„ä»»åŠ¡æ¸…å•</h2>

            <!-- æ·»åŠ ä»»åŠ¡è¡¨å• -->
            <form action="/add" method="post" class="input-group mb-3">
                <input type="text" name="title" class="form-control" placeholder="âœï¸ è¾“å…¥ä¸€ä¸ªæ–°ä»»åŠ¡..." required>
                <button class="btn btn-primary" type="submit">â• æ·»åŠ </button>
            </form>

            <!-- æœç´¢ä»»åŠ¡ -->
            <form method="GET" action="/" class="input-group mb-4">
                <input type="text" name="q" class="form-control" placeholder="ğŸ” æœç´¢ä»»åŠ¡..." value="{{ keyword }}">
                <button class="btn btn-outline-secondary" type="submit">æœç´¢</button>
            </form>

            <!-- ç­›é€‰æŒ‰é’® -->
            <div class="mb-3 text-center">
                <a href="/" class="btn btn-sm btn-outline-primary">ğŸ“‹ å…¨éƒ¨</a>
                <a href="/pending" class="btn btn-sm btn-outline-warning">â³ æœªå®Œæˆ</a>
                <a href="/completed" class="btn btn-sm btn-outline-success">âœ… å·²å®Œæˆ</a>
            </div>

            <!-- ä»»åŠ¡åˆ—è¡¨ -->
            <ul class="list-group" id="task-list">
                {% for task in tasks %}
                    <li class="list-group-item d-flex justify-content-between align-items-start flex-wrap" id="task-{{ task.id }}">
                        <div>
                            <div class="task-title {% if task.complete %}completed{% endif %}">{{ task.title }}</div>
                            <div class="task-time">ğŸ“… {{ task.created_at.strftime('%Y-%m-%d %H:%M:%S') }}</div>
                        </div>
                        <div class="task-actions">
                            {% if not task.complete %}
                                <button class="btn btn-sm btn-success" onclick="completeTask({{ task.id }})">âœ… å®Œæˆ</button>
                            {% endif %}
                            <a href="/edit/{{ task.id }}" class="btn btn-sm btn-secondary">âœï¸ ä¿®æ”¹</a>
                            <button class="btn btn-sm btn-danger" onclick="deleteTask({{ task.id }})">ğŸ—‘ï¸ åˆ é™¤</button>
                        </div>
                    </li>
                {% else %}
                    <li class="list-group-item text-center text-muted">ğŸ˜´ æ²¡æœ‰ä»»åŠ¡å“¦ï¼Œå¿«æ·»åŠ ä¸€ä¸ªå§ï¼</li>
                {% endfor %}
            </ul>
        </div>
    </div>

    <!-- JS è„šæœ¬ -->
    <script>
        function deleteTask(id) {
            fetch(`/api/delete/${id}`, {
                method: 'POST'
            }).then(response => response.json())
              .then(data => {
                  if (data.status === 'success') {
                      const taskElement = document.getElementById(`task-${id}`);
                      if (taskElement) taskElement.remove();
                  }
              });
        }

        function completeTask(id) {
            fetch(`/api/complete/${id}`, {
                method: 'POST'
            }).then(response => response.json())
              .then(data => {
                  if (data.status === 'success') {
                      const taskElement = document.getElementById(`task-${id}`);
                      if (taskElement) {
                          const title = taskElement.querySelector('.task-title');
                          title.classList.add('completed');
                          taskElement.querySelector('.btn-success')?.remove();
                      }
                  }
              });
        }
    </script>
</body>
</html>